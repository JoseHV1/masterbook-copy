<mat-card-header class="mb-2">
  <div class="d-flex w-100 justify-content-between align-items-center mb-4">
    <div class="h5 mb-0 d-flex align-items-center gap-2">
      <mat-icon color="primary">settings</mat-icon>
      <span>Report Configuration</span>
    </div>
  </div>
</mat-card-header>

<mat-card-content>
  <form *ngIf="form" [formGroup]="form" class="w-100">
    <!-- Report Type -->
    <div class="mb-3">
      <div class="section-title">
        <span>Report Type</span>
      </div>
      <div class="row g-3">
        <div class="col-12">
          <app-dropdown-field
            [placeholder]="'Select a report type'"
            formControlName="reportType"
            [options]="dropDownReportType"></app-dropdown-field>
        </div>
      </div>
    </div>

    <div *ngIf="form.get('reportType')?.value">
      <!-- Filters -->
      <div class="mb-3">
        <div
          class="section-title d-flex align-items-center justify-content-between">
          <p>Filters</p>
          <span
            class="material-icons-outlined text-danger"
            style="cursor: pointer"
            (click)="resetAllFieldsExceptReportType()"
            matTooltip="Clean filters">
            delete
          </span>
        </div>
        <p class="form-help">Refine the scope of your report</p>

        <div class="row g-3 mb-3">
          <!-- Date Preset: DROPDOWN -->
          <div class="col-12 col-md-6">
            <mat-label>Date Range</mat-label>
            <app-dropdown-field
              formControlName="dateRange"
              [options]="dropDownDateRange"></app-dropdown-field>
          </div>

          <!-- Custom date inputs (only when Custom is selected) -->
          <div
            class="col-12 col-md-3 d-flex gap-3 align-items-stretch"
            *ngIf="isCustomRange">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>From</mat-label>
              <input
                matInput
                [matDatepicker]="pickerFrom"
                formControlName="effectiveFrom" />
              <mat-datepicker-toggle
                matSuffix
                [for]="pickerFrom"></mat-datepicker-toggle>
              <mat-datepicker #pickerFrom></mat-datepicker>
            </mat-form-field>
          </div>

          <div
            class="col-12 col-md-3 d-flex gap-3 align-items-stretch"
            *ngIf="isCustomRange">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>To</mat-label>
              <input
                matInput
                [matDatepicker]="pickerTo"
                formControlName="effectiveTo" />
              <mat-datepicker-toggle
                matSuffix
                [for]="pickerTo"></mat-datepicker-toggle>
              <mat-datepicker #pickerTo></mat-datepicker>
            </mat-form-field>
          </div>

          <!-- Status -->
          <div
            [ngClass]="{
              'col-12 col-md-12': isCustomRange,
              'col-12 col-md-6': !isCustomRange
            }"
            *ngIf="show.status">
            <mat-label>Status</mat-label>
            <app-dropdown-field
              [placeholder]="'Select a status'"
              formControlName="status"
              [options]="dropDownStatus"></app-dropdown-field>
          </div>
        </div>

        <!-- Context-aware filters -->
        <div class="row g-3">
          <!-- Business Line -->
          <div class="col-12 col-md-6" *ngIf="show.businessLine">
            <mat-label>Business Line</mat-label>
            <app-dropdown-field
              [placeholder]="'Select a business line'"
              formControlName="businessLine"
              [options]="dropDownBusinessLine"></app-dropdown-field>
          </div>

          <!-- Policy Category -->
          <div
            class="col-12 col-md-6"
            *ngIf="show.policyCategory && dropDownPolicyCategory.length > 0">
            <mat-label>Policy Category</mat-label>
            <app-dropdown-field
              [placeholder]="'Select a policy category'"
              formControlName="policyCategory"
              [options]="dropDownPolicyCategory"></app-dropdown-field>
          </div>

          <!-- Policy Type -->
          <div
            class="col-12 col-md-6"
            *ngIf="show.policyType && dropDownPolicyType.length > 0">
            <mat-label>Policy Type</mat-label>
            <app-dropdown-field
              [placeholder]="'Select a policy type'"
              formControlName="policyType"
              [options]="dropDownPolicyType"></app-dropdown-field>
          </div>

          <!-- Insurer -->
          <div class="col-12 col-md-6" *ngIf="show.insurer">
            <mat-label>Insurer</mat-label>
            <app-dropdown-field
              [placeholder]="'Select a insurer'"
              formControlName="insurer"
              [options]="dropDownInsurers"></app-dropdown-field>
          </div>

          <!-- Agent -->
          <div class="col-12 col-md-6" *ngIf="show.broker">
            <mat-label>Agent</mat-label>
            <app-dropdown-field
              [placeholder]="'Select a agent'"
              formControlName="broker"
              [options]="dropDownBrokers"></app-dropdown-field>
          </div>

          <!-- Account -->
          <div class="col-12 col-md-6" *ngIf="show.account">
            <mat-label>Account</mat-label>
            <app-dropdown-field
              [placeholder]="'Select a account'"
              formControlName="account"
              [options]="dropDownAccounts"></app-dropdown-field>
          </div>

          <!-- Payment From -->
          <div class="col-12 col-md-6" *ngIf="show.paymentFrom">
            <mat-label>Payment From</mat-label>
            <app-dropdown-field
              [placeholder]="'Select a option'"
              formControlName="paymentFrom"
              [options]="dropDownpaymentFrom"></app-dropdown-field>
          </div>

          <!-- Minimum Premium -->
          <div class="col-12 col-md-6" *ngIf="show.minPrimeAmount">
            <mat-label>Minimum Prime Amount</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="minPrimeAmount"></app-input>
          </div>

          <!-- Maximum Premium -->
          <div class="col-12 col-md-6" *ngIf="show.maxPrimeAmount">
            <mat-label>Maximum Prime Amount</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="maxPrimeAmount"></app-input>
          </div>

          <!-- Minimum Premium -->
          <div class="col-12 col-md-6" *ngIf="show.minCoverage">
            <mat-label>Minimum Coverage</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="minCoverage"></app-input>
          </div>

          <!-- Maximum Premium -->
          <div class="col-12 col-md-6" *ngIf="show.maxCoverage">
            <mat-label>Maximum Coverage</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="maxCoverage"></app-input>
          </div>

          <!-- Minimum Deductible -->
          <div class="col-12 col-md-6" *ngIf="show.minDeductible">
            <mat-label>Minimum Deductible</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="minDeductible"></app-input>
          </div>

          <!-- Maximum Deductible -->
          <div class="col-12 col-md-6" *ngIf="show.maxDeductible">
            <mat-label>Maximum Deductible</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="maxDeductible"></app-input>
          </div>

          <!-- Minimum Total Amount -->
          <div class="col-12 col-md-6" *ngIf="show.minTotalAmount">
            <mat-label>Minimum Total Amount</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="minTotalAmount"></app-input>
          </div>

          <!-- Maximum Total Amount -->
          <div class="col-12 col-md-6" *ngIf="show.maxTotalAmount">
            <mat-label>Maximum Total Amount</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="maxTotalAmount"></app-input>
          </div>

          <!-- Minimum Commission Pay -->
          <div class="col-12 col-md-6" *ngIf="show.minCommissionPay">
            <mat-label>Minimum Commission Pay</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="minCommissionPay"></app-input>
          </div>

          <!-- Maximum Commission Pay -->
          <div class="col-12 col-md-6" *ngIf="show.maxCommissionPay">
            <mat-label>Maximum Commission Pay</mat-label>
            <app-input
              placeholder="$ 0"
              type="tel"
              [inputMask]="'separator.2'"
              [maskPrefix]="'$ '"
              formControlName="maxCommissionPay"></app-input>
          </div>
        </div>

        <!-- Operations -->
        <div class="mb-3">
          <div class="section-title">
            <span>Operations</span>
          </div>
          <p class="form-help">Group, aggregate, and sort your report data</p>

          <div class="row g-3">
            <div class="col-md-6" *ngIf="show.groupBy">
              <mat-label>Group By</mat-label>
              <app-dropdown-field
                [placeholder]="'Select a group by'"
                formControlName="groupBy"
                [options]="dropDownGroupBy"></app-dropdown-field>
              <small
                class="text-danger"
                *ngIf="form.get('groupBy')?.hasError('requiredForAggregate')">
                Group By is required when Aggregate is selected.
              </small>
            </div>

            <div class="col-md-6" *ngIf="show.aggregate">
              <mat-label>Aggregates</mat-label>
              <app-dropdown-field
                [placeholder]="'Select a aggregate'"
                formControlName="aggregate"
                [options]="dropDownAggregate"></app-dropdown-field>
            </div>

            <div class="col-md-6" *ngIf="show.sort">
              <mat-label>Sort</mat-label>
              <app-dropdown-field
                [placeholder]="'Select a sort'"
                formControlName="sort"
                [options]="dropDownSort"></app-dropdown-field>
            </div>
          </div>
        </div>
      </div>

      <!-- Output Format -->
      <div class="mb-2">
        <div class="section-title">
          <mat-icon color="primary">ios_share</mat-icon>
          <span>Output Format</span>
        </div>
        <mat-button-toggle-group
          formControlName="format"
          class="w-100 format-toggle"
          appearance="legacy">
          <mat-button-toggle value="xlsx">
            <mat-icon>table_view</mat-icon>
            Excel (.xlsx)
          </mat-button-toggle>
          <mat-button-toggle value="csv">
            <mat-icon>grid_on</mat-icon>
            CSV
          </mat-button-toggle>
          <mat-button-toggle value="pdf">
            <mat-icon>picture_as_pdf</mat-icon>
            PDF
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>

      <!-- Actions -->
      <div
        class="mt-3 d-flex align-items-center justify-content-center gap-3 mt-2 mb-3 my-md-0">
        <button
          class="primary-button big-button back-light-blue-500 white"
          (click)="onGenerate()">
          Generate Report
        </button>
        <!-- <button mat-stroked-button color="primary" (click)="onPreview()">
        <mat-icon>visibility</mat-icon>
        Preview
      </button> -->
      </div>
    </div>
  </form>
</mat-card-content>
