<h2 mat-dialog-title>
  {{ data.mode === 'edit' ? 'Edit event' : 'Create event' }}
</h2>

<mat-dialog-content [formGroup]="form" class="dialog-body">
  <!-- Existing Meet link preview -->
  <div *ngIf="data.meetUrl" class="mb-3">
    <a
      mat-stroked-button
      color="primary"
      [href]="data.meetUrl"
      target="_blank"
      rel="noopener">
      Join with Google Meet
    </a>
  </div>

  <mat-form-field appearance="outline" class="full">
    <mat-label>Title</mat-label>
    <input
      matInput
      formControlName="title"
      placeholder="e.g., Policy review call" />
    <mat-error *ngIf="form.controls.title.hasError('required')"
      >Title is required</mat-error
    >
  </mat-form-field>

  <mat-form-field appearance="outline" class="full">
    <mat-label>Description</mat-label>
    <textarea matInput rows="3" formControlName="description"></textarea>
  </mat-form-field>

  <mat-form-field appearance="outline" class="full">
    <mat-label>Location</mat-label>
    <input
      matInput
      formControlName="location"
      placeholder="e.g., Office HQ / Room 5" />
  </mat-form-field>

  <mat-checkbox formControlName="allDay">All day</mat-checkbox>

  <div class="row">
    <div class="col">
      <mat-form-field appearance="outline" class="full">
        <mat-label>Start date</mat-label>
        <input matInput [matDatepicker]="sd" formControlName="startDate" />
        <mat-datepicker-toggle matSuffix [for]="sd"></mat-datepicker-toggle>
        <mat-datepicker #sd></mat-datepicker>
      </mat-form-field>
    </div>
    <div class="col" *ngIf="!form.value.allDay">
      <mat-form-field appearance="outline" class="full">
        <mat-label>Start time</mat-label>
        <input matInput type="time" formControlName="startTime" />
      </mat-form-field>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <mat-form-field appearance="outline" class="full">
        <mat-label>End date</mat-label>
        <input matInput [matDatepicker]="ed" formControlName="endDate" />
        <mat-datepicker-toggle matSuffix [for]="ed"></mat-datepicker-toggle>
        <mat-datepicker #ed></mat-datepicker>
      </mat-form-field>
    </div>
    <div class="col" *ngIf="!form.value.allDay">
      <mat-form-field appearance="outline" class="full">
        <mat-label>End time</mat-label>
        <input matInput type="time" formControlName="endTime" />
      </mat-form-field>
    </div>
  </div>

  <!-- Attendees -->
  <mat-form-field appearance="outline" class="full">
    <mat-label>Invitees (emails separated by comma/space/semicolon)</mat-label>
    <input
      matInput
      formControlName="attendeesText"
      placeholder="alice@ex.com, bob@ex.com" />
  </mat-form-field>

  <!-- Create Meet toggle (only relevant if no existing meetUrl) -->
  <mat-checkbox *ngIf="!data.meetUrl" formControlName="createMeetLink">
    Create a Google Meet link
  </mat-checkbox>

  <!-- Quick read-only list of existing attendees (from Google) -->
  <div *ngIf="data.attendees?.length" class="mt-3">
    <strong>Current attendees:</strong>
    <div class="chips">
      <span
        *ngFor="let attendee of data.attendees"
        class="chip"
        [ngClass]="{
          'chip--accepted': attendee.responseStatus === 'accepted',
          'chip--declined': attendee.responseStatus === 'declined',
          'chip--needs': attendee.responseStatus === 'needsAction'
        }">
        <span class="chip__text">
          {{ attendee.displayName || attendee.email }}
        </span>
        <small *ngIf="attendee.responseStatus">
          ({{ attendee.responseStatus }})
        </small>
      </span>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="center">
  <!-- Left: Delete (only when editing) -->
  <button
    *ngIf="data.mode === 'edit'"
    mat-stroked-button
    color="warn"
    (click)="deleteEvent()"
    style="margin-right: 0.5rem">
    Delete
  </button>

  <!-- Right: Cancel / Save -->
  <span></span>
  <div>
    <button mat-button (click)="cancel()">Cancel</button>
    <button mat-raised-button color="primary" (click)="save()">Save</button>
  </div>
</mat-dialog-actions>
