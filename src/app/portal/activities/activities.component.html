<ng-container content>
  <div #dashboardPdfRoot [class.exporting]="isExporting">
    <div class="dashboard-toolbar">
      <div class="dashboard-toolbar__spacer"></div>

      <button
        mat-icon-button
        class="export-icon-btn"
        (click)="downloadDashboardPdf()"
        [disabled]="isExporting"
        matTooltip="Download PDF">
        <mat-icon>download</mat-icon>
      </button>
    </div>
    <app-summary-cards [dashboardTotals]="dashboardTotals"></app-summary-cards>

    <div class="container">
      <!-- Row 1: Accounts + Quotes -->
      <div class="row g-4">
        <div class="col-12 col-lg-6">
          <mat-card class="kpi-card">
            <div class="chart-container">
              <app-kpi-chart
                [chartOptions]="accountsDataResponse"
                [dateRange]="selectedDateRange.accounts"></app-kpi-chart>
            </div>

            <div class="divider-wrapper">
              <mat-divider class="styled-divider"></mat-divider>
            </div>

            <div class="card-content">
              <div class="card-header">
                <app-chart-filters
                  chart="accounts"
                  [showDateRange]="true"
                  [showAgents]="true"
                  [showCompanies]="false"
                  [dateRanges]="dateRanges"
                  [agents]="agentsList"
                  (filtersApplied)="onFiltersApplied($event)">
                </app-chart-filters>

                <div>
                  <h3>Accounts</h3>
                  <p>{{ selectedDateRange.accounts }}</p>
                  <p>
                    {{
                      selectedAgent.accounts.name
                        ? 'Broker: ' + selectedAgent.accounts.name
                        : ''
                    }}
                  </p>
                </div>
              </div>
            </div>
          </mat-card>
        </div>

        <div class="col-12 col-lg-6">
          <mat-card class="kpi-card">
            <div class="chart-container">
              <app-quotes-status-pie-chart
                [chartData]="quotesDataResponse"></app-quotes-status-pie-chart>
            </div>

            <div class="divider-wrapper">
              <mat-divider class="styled-divider"></mat-divider>
            </div>

            <div class="card-content">
              <div class="card-header">
                <app-chart-filters
                  chart="quotes"
                  [showDateRange]="true"
                  [showAgents]="false"
                  [showCompanies]="true"
                  [dateRanges]="dateRanges"
                  [agents]="agentsList"
                  [insuranceCompanies]="insuranceCompanies"
                  (filtersApplied)="onFiltersApplied($event)">
                </app-chart-filters>

                <div>
                  <h3>Quotes</h3>
                  <p>{{ selectedDateRange.quotes }}</p>
                  <p>
                    {{
                      selectedAgent.quotes.name
                        ? 'Broker: ' + selectedAgent.quotes.name
                        : ''
                    }}
                  </p>
                </div>
              </div>
            </div>
          </mat-card>
        </div>
      </div>

      <!-- Row 2: Requests + Payments -->
      <div class="row g-4 mt-0">
        <div class="col-12 col-lg-6">
          <mat-card class="kpi-card">
            <div class="chart-container">
              <app-requests-by-type-chart
                [chartData]="requestsDataResponse"
                [dateRange]="
                  selectedDateRange.requests
                "></app-requests-by-type-chart>
            </div>

            <div class="divider-wrapper">
              <mat-divider class="styled-divider"></mat-divider>
            </div>

            <div class="card-content">
              <div class="card-header">
                <app-chart-filters
                  chart="requests"
                  [showDateRange]="true"
                  [showAgents]="false"
                  [showCompanies]="false"
                  [dateRanges]="dateRanges"
                  [agents]="agentsList"
                  [insuranceCompanies]="insuranceCompanies"
                  (filtersApplied)="onFiltersApplied($event)">
                </app-chart-filters>

                <div>
                  <h3>Requests</h3>
                  <p>{{ selectedDateRange.requests }}</p>
                  <p>
                    {{
                      selectedAgent.requests.name
                        ? 'Broker: ' + selectedAgent.requests.name
                        : ''
                    }}
                  </p>
                </div>
              </div>
            </div>
          </mat-card>
        </div>

        <div class="col-12 col-lg-6">
          <mat-card class="kpi-card">
            <div class="chart-container">
              <app-stacked-area-chart
                [data]="commissionsStackedData"
                title="Commissions"
                subtitle="Money over time"
                currencySymbol="$">
              </app-stacked-area-chart>
            </div>

            <div class="divider-wrapper">
              <mat-divider class="styled-divider"></mat-divider>
            </div>

            <div class="card-content">
              <div class="card-header">
                <app-chart-filters
                  chart="commissions"
                  [showDateRange]="true"
                  [showAgents]="true"
                  [showCompanies]="false"
                  [dateRanges]="dateRanges"
                  [agents]="agentsList"
                  (filtersApplied)="onFiltersApplied($event)">
                </app-chart-filters>

                <div>
                  <h3>Commissions</h3>
                  <p>{{ selectedDateRange.commissions }}</p>
                </div>
              </div>
            </div>
          </mat-card>
        </div>

        <!-- <div class="col-12 col-lg-6">
        <mat-card class="kpi-card">
          <div class="chart-container">
            <app-payments-chart></app-payments-chart>
          </div>

          <div class="divider-wrapper">
            <mat-divider class="styled-divider"></mat-divider>
          </div>

          <div class="card-content">
            <div class="card-header">
              <app-chart-filters
                chart="payments"
                [showDateRange]="true"
                [showAgents]="true"
                [showCompanies]="false"
                [dateRanges]="dateRanges"
                [agents]="agentsList"
                (filtersApplied)="onFiltersApplied($event)">
              </app-chart-filters>
              <div>
                <h3>Payments</h3>
                <p>Last 7 Days</p>
              </div>
            </div>
          </div>
        </mat-card>
      </div> -->
      </div>

      <!-- Row 3: Map -->
      <div class="row g-4 mt-0">
        <div class="col-12">
          <mat-card class="kpi-card kpi-card--map">
            <div class="map-header">
              <div>
                <h3 class="map-title">Clients Map</h3>
                <p class="map-subtitle">
                  Pins show where your clients are located
                </p>
              </div>

              <div class="map-actions">
                <button
                  mat-stroked-button
                  color="primary"
                  (click)="clientsMap.recenter()">
                  <mat-icon>my_location</mat-icon>
                  Recenter
                </button>
              </div>
            </div>

            <div class="map-body">
              <app-clients-map
                [pins]="clientPinsResponse"
                #clientsMap></app-clients-map>
            </div>
          </mat-card>
        </div>
      </div>

      <!-- Row 4: Upcoming Renewals -->
      <!-- <div class="row g-4 mt-0">
      <div class="col-12 col-lg-8">
        <mat-card class="kpi-card">
          <app-policy-timeline></app-policy-timeline>

          <div class="divider-wrapper">
            <mat-divider class="styled-divider"></mat-divider>
          </div>

          <div class="card-content">
            <div class="card-header">
              <app-chart-filters
                chart="quotes"
                [showDateRange]="true"
                [showAgents]="true"
                [showCompanies]="true"
                [dateRanges]="dateRanges"
                [agents]="agentsList"
                [insuranceCompanies]="insuranceCompanies"
                (filtersApplied)="onFiltersApplied($event)">
              </app-chart-filters>

              <div>
                <h3>Upcoming Renewals</h3>
                <p>{{ selectedDateRange.quotes }}</p>
              </div>
            </div>
          </div>
        </mat-card>
      </div>
    </div> -->

      <!-- Row 5: Commissions (ready to add another card beside later) -->
      <div class="row g-4 mt-0">
        <!-- Future card slot -->
        <div class="col-12 col-lg-6">
          <!-- add next card here later -->
        </div>
      </div>
    </div>
  </div>
</ng-container>
